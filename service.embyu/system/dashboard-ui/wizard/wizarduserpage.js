define(["loading","connectHelper","globalize","dashboardcss","emby-input","emby-button","emby-linkbutton","css!./wizard"],function(loading,connectHelper,globalize){"use strict";function getApiClient(){return ApiClient}function nextWizardPage(){Dashboard.navigate("wizard/wizardlibrary.html")}function onUpdateUserComplete(result){if(loading.hide(),result.UserLinkResult){var msgKey=result.UserLinkResult.IsPending?"MessagePendingEmbyAccountAdded":"MessageEmbyAccountAdded";Dashboard.alert({message:globalize.translate(msgKey),title:globalize.translate("HeaderEmbyAccountAdded"),callback:nextWizardPage})}else nextWizardPage()}function onSubmit(e){return this.querySelector("#txtPassword").value!==this.querySelector("#txtPasswordConfirm").value?require(["alert"],function(alert){alert(globalize.translate("PasswordMatchError"))}):function(form){loading.show();var apiClient=getApiClient();apiClient.ajax({type:"POST",data:{Name:form.querySelector("#txtUsername").value,Password:form.querySelector("#txtPassword").value,ConnectUserName:form.querySelector("#txtConnectUserName").value},url:apiClient.getUrl("Startup/User"),dataType:"json"}).then(onUpdateUserComplete,function(response){response&&response.status;connectHelper.showLinkUserErrorMessage(form.querySelector("#txtConnectUserName").value)})}(this),e.preventDefault(),!1}function onViewShow(){loading.show();var page=this,apiClient=getApiClient();apiClient.getJSON(apiClient.getUrl("Startup/User")).then(function(user){page.querySelector("#txtUsername").value=user.Name||"",page.querySelector("#txtConnectUserName").value=user.ConnectUserName||"",loading.hide()})}return function(view,params){view.querySelector(".wizardUserForm").addEventListener("submit",onSubmit),view.addEventListener("viewshow",onViewShow)}});