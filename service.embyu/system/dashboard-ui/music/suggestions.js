define(["cardBuilder","skinManager","loading","connectionManager","apphost","layoutManager","scrollHelper","focusManager","emby-itemscontainer","emby-scroller"],function(cardBuilder,skinManager,loading,connectionManager,appHost,layoutManager,scrollHelper,focusManager){"use strict";function MusicSuggestionsTab(view,params){this.view=view,this.params=params,this.apiClient=connectionManager.getApiClient(params.serverId),function(view){for(var containers=view.querySelectorAll(".autoScrollSection"),i=0,length=containers.length;i<length;i++){var html,monitor,section=containers[i];section.classList.contains("recentlyPlayedSection")||section.classList.contains("frequentlyPlayedSection")?monitor="audioplayback":(section.classList.contains("favoriteArtistsSection")||section.classList.contains("favoriteAlbumsSection")||section.classList.contains("favoriteSongsSection"))&&(monitor="markfavorite"),html='<div is="emby-scroller" class="padded-top-focusscale padded-bottom-focusscale" data-mousewheel="false" data-centerfocus="true"><div is="emby-itemscontainer" class="itemsContainer scrollSlider focuscontainer-x padded-left padded-right"'+(monitor=monitor?' data-monitor="'+monitor+'"':"")+"></div></div>",section.insertAdjacentHTML("beforeend",html)}}(view),this.latestItemsContainer=view.querySelector(".latestSection .itemsContainer"),this.latestItemsContainer.fetchData=function(){var apiClient=this.apiClient,parentId=this.params.parentId;return apiClient.getLatestItems({IncludeItemTypes:"Audio",Limit:24,Fields:"PrimaryImageAspectRatio,BasicSyncInfo",ParentId:parentId,ImageTypeLimit:1,EnableImageTypes:"Primary",EnableTotalRecordCount:!1})}.bind(this),this.latestItemsContainer.getItemsHtml=function(items,options){return getItemsHtml(items,{})}.bind(this),this.latestItemsContainer.parentContainer=view.querySelector(".latestSection"),this.recentlyPlayedItemsContainer=view.querySelector(".recentlyPlayedSection .itemsContainer"),this.recentlyPlayedItemsContainer.fetchData=function(){var apiClient=this.apiClient,parentId=this.params.parentId;return apiClient.getItems(apiClient.getCurrentUserId(),{SortBy:"DatePlayed",SortOrder:"Descending",IncludeItemTypes:"Audio",Limit:24,Recursive:!0,Fields:"PrimaryImageAspectRatio,CanDelete",Filters:"IsPlayed",ParentId:parentId,ImageTypeLimit:1,EnableImageTypes:"Primary",EnableTotalRecordCount:!1})}.bind(this),this.recentlyPlayedItemsContainer.getItemsHtml=function(items){return getItemsHtml(items,{action:"play",overlayPlayButton:!1,overlayMoreButton:!0})}.bind(this),this.recentlyPlayedItemsContainer.parentContainer=view.querySelector(".recentlyPlayedSection"),this.frequentlyPlayedItemsContainer=view.querySelector(".frequentlyPlayedSection .itemsContainer"),this.frequentlyPlayedItemsContainer.fetchData=function(){var apiClient=this.apiClient,parentId=this.params.parentId;return apiClient.getItems(apiClient.getCurrentUserId(),{SortBy:"PlayCount",SortOrder:"Descending",IncludeItemTypes:"Audio",Limit:24,Recursive:!0,Fields:"PrimaryImageAspectRatio,CanDelete",Filters:"IsPlayed",ParentId:parentId,ImageTypeLimit:1,EnableImageTypes:"Primary",EnableTotalRecordCount:!1})}.bind(this),this.frequentlyPlayedItemsContainer.getItemsHtml=function(items){return getItemsHtml(items,{action:"play",overlayPlayButton:!1,overlayMoreButton:!0})}.bind(this),this.frequentlyPlayedItemsContainer.parentContainer=view.querySelector(".frequentlyPlayedSection"),this.favoriteArtistsItemsContainer=view.querySelector(".favoriteArtistsSection .itemsContainer"),this.favoriteArtistsItemsContainer.fetchData=function(){var apiClient=this.apiClient,parentId=this.params.parentId;return apiClient.getArtists(apiClient.getCurrentUserId(),{SortBy:"SortName",SortOrder:"Ascending",Recursive:!0,Fields:"PrimaryImageAspectRatio,BasicSyncInfo",Filters:"IsFavorite",StartIndex:0,ImageTypeLimit:1,EnableImageTypes:"Primary",EnableTotalRecordCount:!1,ParentId:parentId})}.bind(this),this.favoriteArtistsItemsContainer.getItemsHtml=function(items){return getItemsHtml(items,{overlayPlayButton:!0,showParentTitle:!1})}.bind(this),this.favoriteArtistsItemsContainer.parentContainer=view.querySelector(".favoriteArtistsSection"),this.favoriteAlbumsItemsContainer=view.querySelector(".favoriteAlbumsSection .itemsContainer"),this.favoriteAlbumsItemsContainer.fetchData=function(){var apiClient=this.apiClient,parentId=this.params.parentId;return apiClient.getItems(apiClient.getCurrentUserId(),{SortBy:"Random",IncludeItemTypes:"MusicAlbum",Limit:24,Recursive:!0,Fields:"PrimaryImageAspectRatio,CanDelete",Filters:"IsFavorite",ParentId:parentId,ImageTypeLimit:1,EnableImageTypes:"Primary",EnableTotalRecordCount:!1})}.bind(this),this.favoriteAlbumsItemsContainer.getItemsHtml=function(items){return getItemsHtml(items,{overlayPlayButton:!0})}.bind(this),this.favoriteAlbumsItemsContainer.parentContainer=view.querySelector(".favoriteAlbumsSection"),this.favoriteSongsItemsContainer=view.querySelector(".favoriteSongsSection .itemsContainer"),this.favoriteSongsItemsContainer.fetchData=function(){var apiClient=this.apiClient,parentId=this.params.parentId;return apiClient.getItems(apiClient.getCurrentUserId(),{SortBy:"Random",IncludeItemTypes:"Audio",Limit:24,Recursive:!0,Fields:"PrimaryImageAspectRatio,CanDelete",Filters:"IsFavorite",ParentId:parentId,ImageTypeLimit:1,EnableImageTypes:"Primary",EnableTotalRecordCount:!1})}.bind(this),this.favoriteSongsItemsContainer.getItemsHtml=function(items){return getItemsHtml(items,{action:"play",overlayPlayButton:!1,overlayMoreButton:!0})}.bind(this),this.favoriteSongsItemsContainer.parentContainer=view.querySelector(".favoriteSongsSection"),params.parentId&&(this.latestItemsContainer.setAttribute("data-parentid",params.parentId),this.recentlyPlayedItemsContainer.setAttribute("data-parentid",params.parentId),this.frequentlyPlayedItemsContainer.setAttribute("data-parentid",params.parentId),this.favoriteArtistsItemsContainer.setAttribute("data-parentid",params.parentId),this.favoriteAlbumsItemsContainer.setAttribute("data-parentid",params.parentId),this.favoriteSongsItemsContainer.setAttribute("data-parentid",params.parentId)),function(view,params){[].forEach.call(view.querySelectorAll(".sectionTitleTextButton-link"),function(link){var href=link.getAttribute("data-href");href&&(link.href=skinManager.mapRoute(href+"&serverId="+params.serverId))})}(view,params)}function getItemsHtml(items,options){appHost.supports("imageanalysis");return cardBuilder.getCardsHtml(Object.assign({items:items,showUnplayedIndicator:!1,showLatestItemsPopup:!1,shape:"autooverflow",showTitle:!0,showParentTitle:!0,centerText:!0,overlayPlayButton:!0,allowBottomPadding:!1,cardLayout:!1,vibrant:!1},options))}return MusicSuggestionsTab.prototype.onResume=function(options){var promises=[];promises.push(this.latestItemsContainer.resume(options)),promises.push(this.recentlyPlayedItemsContainer.resume(options)),promises.push(this.frequentlyPlayedItemsContainer.resume(options)),promises.push(this.favoriteArtistsItemsContainer.resume(options)),promises.push(this.favoriteAlbumsItemsContainer.resume(options)),promises.push(this.favoriteSongsItemsContainer.resume(options));var view=this.view;Promise.all(promises).then(function(){options.autoFocus&&focusManager.autoFocus(view)})},MusicSuggestionsTab.prototype.onPause=function(){this.latestItemsContainer.pause(),this.recentlyPlayedItemsContainer.pause(),this.frequentlyPlayedItemsContainer.pause(),this.favoriteArtistsItemsContainer.pause(),this.favoriteAlbumsItemsContainer.pause(),this.favoriteSongsItemsContainer.pause()},MusicSuggestionsTab.prototype.destroy=function(){this.view=null,this.params=null,this.apiClient=null,this.latestItemsContainer=null,this.recentlyPlayedItemsContainer=null,this.frequentlyPlayedItemsContainer=null,this.favoriteArtistsItemsContainer=null,this.favoriteAlbumsItemsContainer=null,this.favoriteSongsItemsContainer=null},MusicSuggestionsTab});