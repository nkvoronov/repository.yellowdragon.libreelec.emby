define([],function(){"use strict";var illegalRe=/[\/\?<>\\:\*\|":]/g,controlRe=/[\x00-\x1f\x80-\x9f]/g,reservedRe=/^\.+$/,windowsReservedRe=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,windowsTrailingRe=/[\. ]+$/;function isHighSurrogate(codePoint){return 55296<=codePoint&&codePoint<=56319}function isLowSurrogate(codePoint){return 56320<=codePoint&&codePoint<=57343}function getByteLength(string){if("string"!=typeof string)throw new Error("Input must be string");for(var charLength=string.length,byteLength=0,codePoint=null,prevCodePoint=null,i=0;i<charLength;i++)isLowSurrogate(codePoint=string.charCodeAt(i))?null!=prevCodePoint&&isHighSurrogate(prevCodePoint)?byteLength+=1:byteLength+=3:codePoint<=127?byteLength+=1:128<=codePoint&&codePoint<=2047?byteLength+=2:2048<=codePoint&&codePoint<=65535&&(byteLength+=3),prevCodePoint=codePoint;return byteLength}return{sanitize:function(input,replacement){return function(string,byteLength){if("string"!=typeof string)throw new Error("Input must be string");for(var codePoint,segment,charLength=string.length,curByteLength=0,i=0;i<charLength;i+=1){if(codePoint=string.charCodeAt(i),segment=string[i],isHighSurrogate(codePoint)&&isLowSurrogate(string.charCodeAt(i+1))&&(segment+=string[i+=1]),(curByteLength+=getByteLength(segment))===byteLength)return string.slice(0,i+1);if(byteLength<curByteLength)return string.slice(0,i-segment.length+1)}return string}(input.replace(illegalRe,replacement).replace(controlRe,replacement).replace(reservedRe,replacement).replace(windowsReservedRe,replacement).replace(windowsTrailingRe,replacement),255)}}});