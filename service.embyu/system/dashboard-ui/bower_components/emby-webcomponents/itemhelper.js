define(["apphost","globalize"],function(appHost,globalize){"use strict";function canEditInternal(user,item){var itemType=item.Type;return"UserRootFolder"!==itemType&&"CollectionFolder"!==itemType&&"UserView"!==itemType&&"PlaylistsFolder"!==itemType&&("Program"!==itemType&&("Genre"!==itemType&&"MusicGenre"!==itemType&&"GameGenre"!==itemType&&"Studio"!==itemType&&("Timer"!==itemType&&("SeriesTimer"!==itemType&&("Plugin"!==itemType&&(("Recording"!==item.Type||"Completed"===item.Status)&&!isLocalItem(item)))))))}function isLocalItem(item){if(item){var id=item.Id;if("string"==typeof id&&0===id.indexOf("local"))return!0}return!1}return{getDisplayName:function(item,options){if(!item)throw new Error("null item passed into getDisplayName");options=options||{},"Timer"===item.Type&&(item=item.ProgramInfo||item);var name=("Program"!==item.Type&&"Recording"!==item.Type||!item.IsSeries&&!item.EpisodeTitle?item.Name:item.EpisodeTitle)||"";if("TvChannel"===item.Type)return item.ChannelNumber?item.ChannelNumber+" "+name:name;if("Episode"===item.Type&&0===item.ParentIndexNumber)name=globalize.translate("ValueSpecialEpisodeName",name);else if(("Episode"===item.Type||"Program"===item.Type)&&null!=item.IndexNumber&&null!=item.ParentIndexNumber&&!1!==options.includeIndexNumber){var displayIndexNumber=item.IndexNumber,number=displayIndexNumber,nameSeparator=" - ";!1!==options.includeParentInfo?number="S"+item.ParentIndexNumber+":E"+number:nameSeparator=". ",item.IndexNumberEnd&&(number+="-"+(displayIndexNumber=item.IndexNumberEnd)),number&&(name=name?number+nameSeparator+name:number)}return name},supportsAddingToCollection:function(item){return("Recording"!==item.Type||"Completed"===item.Status)&&(!item.CollectionType&&(-1===["Genre","MusicGenre","Studio","GameGenre","UserView","CollectionFolder","Audio","Program","Timer","SeriesTimer","BoxSet"].indexOf(item.Type)&&(!isLocalItem(item)&&("Photo"!==item.MediaType&&(!(!item.IsFolder&&"MusicArtist"!==item.Type)||!!item.ParentId)))))},supportsAddingToPlaylist:function(item){return"Program"!==item.Type&&("TvChannel"!==item.Type&&("Timer"!==item.Type&&("SeriesTimer"!==item.Type&&("PlaylistsFolder"!==item.Type&&("Photo"!==item.MediaType&&("Game"!==item.MediaType&&(("Recording"!==item.Type||"Completed"===item.Status)&&(!isLocalItem(item)&&("livetv"!==item.CollectionType&&(!(!item.IsFolder&&"Genre"!==item.Type&&"MusicGenre"!==item.Type&&"MusicArtist"!==item.Type)||!!item.ParentId&&item.MediaType))))))))))},isLocalItem:isLocalItem,canIdentify:function(user,item){var itemType=item.Type;return!("Movie"!==itemType&&"Trailer"!==itemType&&"Series"!==itemType&&"Game"!==itemType&&"BoxSet"!==itemType&&"Person"!==itemType&&"Book"!==itemType&&"MusicAlbum"!==itemType&&"MusicArtist"!==itemType&&"MusicVideo"!==itemType||!user.Policy.IsAdministrator||isLocalItem(item))},canEdit:function(user,item){return canEditInternal(0,item)&&user.Policy.IsAdministrator},canEditSubtitles:function(user,item){if("Video"===item.MediaType&&"TvChannel"!==item.Type&&"Program"!==item.Type&&"Virtual"!==item.LocationType&&("Recording"!==item.Type||"Completed"===item.Status)){if(user.Policy.EnableSubtitleDownloading||user.Policy.EnableSubtitleManagement)return canEditInternal(0,item);if(null==user.Policy.EnableSubtitleDownloading&&null==user.Policy.EnableSubtitleManagement)return canEditInternal(0,item)&&user.Policy.IsAdministrator}return!1},canEditImages:function(user,item){var itemType=item.Type;return"Photo"!==item.MediaType&&("CollectionFolder"!==itemType&&"UserView"!==itemType&&"PlaylistsFolder"!==itemType&&"Genre"!==itemType&&"MusicGenre"!==itemType&&"GameGenre"!==itemType&&"Studio"!==itemType||isLocalItem(item)?"Genre"!==itemType&&"MusicGenre"!==itemType&&"GameGenre"!==itemType&&"Studio"!==itemType&&"Device"!==itemType&&"User"!==itemType&&"Plugin"!==itemType&&(("Recording"!==item.Type||"Completed"===item.Status)&&(canEditInternal(0,item)&&user.Policy.IsAdministrator)):!!user.Policy.IsAdministrator)},canSync:function(user,item){return!(user&&!user.Policy.EnableContentDownloading)&&(!isLocalItem(item)&&item.SupportsSync)},canShare:function(item,user){return"Program"!==item.Type&&("TvChannel"!==item.Type&&("Timer"!==item.Type&&("SeriesTimer"!==item.Type&&(("Recording"!==item.Type||"Completed"===item.Status)&&(!isLocalItem(item)&&(user.Policy.EnablePublicSharing&&appHost.supports("sharing")))))))},enableDateAddedDisplay:function(item){return!item.IsFolder&&item.MediaType&&"Program"!==item.Type&&"TvChannel"!==item.Type&&"Trailer"!==item.Type},canMarkPlayed:function(item){if(item.SupportsResume)return!0;var itemType=item.Type,mediaType=item.MediaType;return"Program"!==itemType&&("Video"===mediaType&&"TvChannel"!==itemType||("AudioBook"===itemType||"Series"===itemType||"Season"===itemType||"BoxSet"===itemType||"Game"===mediaType||"Book"===mediaType||"Recording"===mediaType))},canRate:function(item){var itemType=item.Type;return"Program"!==itemType&&"Timer"!==itemType&&"SeriesTimer"!==itemType&&"CollectionFolder"!==itemType&&"UserView"!==itemType&&"Channel"!==itemType&&"Season"!==itemType&&"Studio"!==itemType&&"PlaylistsFolder"!==itemType&&!!item.UserData},canConvert:function(item,user){if(!user.Policy.EnableMediaConversion)return!1;if(isLocalItem(item))return!1;var mediaType=item.MediaType;if("Book"===mediaType||"Photo"===mediaType||"Game"===mediaType||"Audio"===mediaType)return!1;if("livetv"===item.CollectionType)return!1;var type=item.Type;return"TvChannel"!==type&&"Channel"!==type&&"Person"!==type&&"Year"!==type&&"Program"!==type&&"Timer"!==type&&"SeriesTimer"!==type&&"GameGenre"!==type&&"PlaylistsFolder"!==type&&"Device"!==type&&"User"!==type&&"Plugin"!==type&&!("Virtual"===item.LocationType&&!item.IsFolder)},canRefreshMetadata:function(item,user){if(user.Policy.IsAdministrator){if("livetv"===item.CollectionType)return!1;var itemType=item.Type;if("Device"===itemType||"User"===itemType||"Plugin"===itemType)return!1;if("Timer"!==item.Type&&"SeriesTimer"!==item.Type&&"Program"!==item.Type&&"TvChannel"!==item.Type&&"PlaylistsFolder"!==item.Type&&("Recording"!==item.Type||"Completed"===item.Status)&&!isLocalItem(item))return!0}return!1},supportsMediaSourceSelection:function(item){return"Video"===item.MediaType&&("TvChannel"!==item.Type&&!(!item.MediaSources||1===item.MediaSources.length&&"Placeholder"===item.MediaSources[0].Type))},supportsSimilarItems:function(item){var itemType=item.Type;return"Movie"===itemType||"Trailer"===itemType||"Series"===itemType||"Program"===itemType||"Recording"===itemType||"Game"===itemType||"MusicAlbum"===itemType||"MusicArtist"===itemType||"Playlist"===itemType},supportsSimilarItemsOnLiveTV:function(item,apiClient){var itemType=item.Type;return!!apiClient.isMinServerVersion("3.6.0.18")&&("Movie"===itemType||"Trailer"===itemType||"Series"===itemType)},supportsExtras:function(item){return!item.IsFolder&&("TvChannel"!==item.Type&&"Video"===item.MediaType)}}});