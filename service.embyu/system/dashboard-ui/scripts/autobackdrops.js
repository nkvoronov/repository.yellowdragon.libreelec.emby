define(["backdrop","userSettings"],function(backdrop,userSettings){"use strict";var cache={};function showBackdrop(type,parentId){var apiClient=window.ApiClient;apiClient&&function(apiClient,userId,types,parentId){var key="backdrops2_"+userId+(types||"")+(parentId||""),data=cache[key];if(data)return console.log("Found backdrop id list in cache. Key: "+key),data=JSON.parse(data),Promise.resolve(data);var options={SortBy:"IsFavoriteOrLiked,Random",Limit:20,Recursive:!0,IncludeItemTypes:types,ImageTypes:"Backdrop",ParentId:parentId,EnableTotalRecordCount:!1};return apiClient.getItems(apiClient.getCurrentUserId(),options).then(function(result){var images=result.Items.map(function(i){return{Id:i.Id,tag:i.BackdropImageTags[0],ServerId:i.ServerId}});return cache[key]=JSON.stringify(images),images})}(apiClient,apiClient.getCurrentUserId(),type,parentId).then(function(images){images.length?backdrop.setBackdrops(images.map(function(i){return i.BackdropImageTags=[i.tag],i})):backdrop.clear()})}document.addEventListener("viewbeforeshow",function(e){var page=e.target,classList=page.classList;classList.contains("selfBackdropPage")||(classList.contains("backdropPage")?userSettings.enableBackdrops()?showBackdrop(page.getAttribute("data-backdroptype"),classList.contains("globalBackdropPage")?"":getParameterByName("topParentId")):(classList.remove("backdropPage"),backdrop.clear()):backdrop.clear())})});