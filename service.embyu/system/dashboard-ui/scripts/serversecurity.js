define(["datetime","loading","mainTabsManager","dom","globalize","emby-button","detailtablecss"],function(datetime,loading,mainTabsManager,dom,globalize){"use strict";function loadData(page){loading.show(),ApiClient.getJSON(ApiClient.getUrl("Auth/Keys")).then(function(result){!function(page,keys){var rows=keys.map(function(item){var html="";html+='<tr class="detailTableBodyRow detailTableBodyRow-shaded">',html+='<td class="detailTableBodyCell">',html+='<button type="button" is="emby-button" data-token="'+item.AccessToken+'" class="raised raised-mini btnRevoke" data-mini="true" title="'+globalize.translate("ButtonRevoke")+'" style="margin:0;">'+globalize.translate("ButtonRevoke")+"</button>",html+="</td>",html+='<td class="detailTableBodyCell" style="vertical-align:middle;">',html+=item.AccessToken,html+="</td>",html+='<td class="detailTableBodyCell" style="vertical-align:middle;">',html+=item.AppName||"",html+="</td>",html+='<td class="detailTableBodyCell" style="vertical-align:middle;">';var date=datetime.parseISO8601Date(item.DateCreated,!0);return html+=datetime.toLocaleDateString(date)+" "+datetime.getDisplayTime(date),html+="</td>",html+="</tr>"}).join("");page.querySelector(".resultBody").innerHTML=rows,loading.hide()}(page,result.Items)})}function getTabs(){return[{href:"dashboardhosting.html",name:globalize.translate("TabHosting")},{href:"serversecurity.html",name:globalize.translate("TabSecurity")}]}return function(view,params){var page=view;page.querySelector(".btnNewKey").addEventListener("click",function(){!function(page){require(["prompt"],function(prompt){prompt({title:globalize.translate("HeaderNewApiKey"),label:globalize.translate("LabelAppName"),description:globalize.translate("LabelAppNameExample")}).then(function(value){ApiClient.ajax({type:"POST",url:ApiClient.getUrl("Auth/Keys",{App:value})}).then(function(){loadData(page)})})})}(page)}),page.querySelector(".tblApiKeys").addEventListener("click",function(e){var btnRevoke=dom.parentWithClass(e.target,"btnRevoke");btnRevoke&&function(page,key){require(["confirm"],function(confirm){confirm(globalize.translate("MessageConfirmRevokeApiKey"),globalize.translate("HeaderConfirmRevokeApiKey")).then(function(){loading.show(),ApiClient.ajax({type:"DELETE",url:ApiClient.getUrl("Auth/Keys/"+key)}).then(function(){loadData(page)})})})}(page,btnRevoke.getAttribute("data-token"))}),view.addEventListener("viewshow",function(){mainTabsManager.setTabs(this,1,getTabs);loadData(this)})}});