define(["userSettings","loading","connectionManager","apphost","layoutManager","focusManager","homeSections","emby-itemscontainer"],function(userSettings,loading,connectionManager,appHost,layoutManager,focusManager,homeSections){"use strict";function HomeTab(view,params){this.view=view,this.params=params,this.apiClient=connectionManager.currentApiClient(),this.sectionsContainer=view.querySelector(".sections"),view.querySelector(".sections").addEventListener("settingschange",function(){this.sectionsRendered=!1,this.paused||this.onResume({refresh:!0})}.bind(this))}return HomeTab.prototype.onResume=function(options){if(this.sectionsRendered){var sectionsContainer=this.sectionsContainer;return sectionsContainer?homeSections.resume(sectionsContainer,options):Promise.resolve()}this.refresh(options)},HomeTab.prototype.refresh=function(options){loading.show();var view=this.view,apiClient=this.apiClient;return this.destroyHomeSections(),this.sectionsRendered=!0,apiClient.getCurrentUser().then(function(user){return homeSections.loadSections(view.querySelector(".sections"),apiClient,user,userSettings).then(function(){options.autoFocus&&(focusManager.autoFocus(view)||setTimeout(function autoFocus(){!focusManager.autoFocus(this.view)&&this.retries<20?(this.retries++,setTimeout(autoFocus.bind(this),100)):(this.view=null,this.retries=null)}.bind({retries:0,view:view}),100));loading.hide()})})},HomeTab.prototype.onPause=function(){var sectionsContainer=this.sectionsContainer;sectionsContainer&&homeSections.pause(sectionsContainer)},HomeTab.prototype.destroy=function(){this.view=null,this.params=null,this.apiClient=null,this.destroyHomeSections(),this.sectionsContainer=null},HomeTab.prototype.destroyHomeSections=function(){var sectionsContainer=this.sectionsContainer;sectionsContainer&&homeSections.destroySections(sectionsContainer)},HomeTab});